<div class="reports-page">

  <mat-card class="filters-card">
    <mat-card-title>Reports</mat-card-title>

    <div class="filters">
      <mat-form-field appearance="outline" class="date-range">
        <mat-label>Date range</mat-label>
        <mat-date-range-input [rangePicker]="picker" [formGroup]="rangeForm">
          <input matStartDate formControlName="start" placeholder="Start date" />
          <input matEndDate formControlName="end" placeholder="End date" />
        </mat-date-range-input>
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>

      <div class="preset-buttons">
        <button mat-stroked-button type="button" (click)="setThisMonth()">This month</button>
        <button mat-stroked-button type="button" (click)="setLastMonth()">Last month</button>
      </div>
    </div>
  </mat-card>

  <mat-tab-group>
    <!-- 1) Top Spending Categories -->
    <mat-tab label="Top Spending Categories">
      <mat-card class="report-card">
        <mat-card-title>Top Spending Categories</mat-card-title>

        <div class="summary-row">
          <div class="summary-item">
            <div class="label">Total spending</div>
            <div class="value">{{ spendingTotal | currency }}</div>
          </div>
        </div>

        <table mat-table [dataSource]="topSpendingCategories" class="w-100">
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef>Category</th>
            <td mat-cell *matCellDef="let row">{{ row.categoryName }}</td>
          </ng-container>

          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef class="text-right">Amount</th>
            <td mat-cell *matCellDef="let row" class="text-right">{{ row.amount | currency }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="spendingCols"></tr>
          <tr mat-row *matRowDef="let row; columns: spendingCols"></tr>
        </table>
      </mat-card>
    </mat-tab>

    <!-- 2) Top Income -->
    <mat-tab label="Top Income">
      <mat-card class="report-card">
        <mat-card-title>Top Income</mat-card-title>

        <div class="summary-row">
          <div class="summary-item">
            <div class="label">Total income</div>
            <div class="value">{{ incomeTotal | currency }}</div>
          </div>
        </div>

        <table mat-table [dataSource]="topIncomeCategories" class="w-100">
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef>Category</th>
            <td mat-cell *matCellDef="let row">{{ row.categoryName }}</td>
          </ng-container>

          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef class="text-right">Amount</th>
            <td mat-cell *matCellDef="let row" class="text-right">{{ row.amount | currency }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="incomeCols"></tr>
          <tr mat-row *matRowDef="let row; columns: incomeCols"></tr>
        </table>
      </mat-card>
    </mat-tab>

    <!-- 3) Cashflow -->
    <mat-tab label="Cashflow">
      <mat-card class="report-card">
        <mat-card-title>Cashflow (Actual + Projected Recurring)</mat-card-title>

        <div class="summary-row">
          <div class="summary-item">
            <div class="label">Actual income</div>
            <div class="value">{{ cashflowSummary.actualIncome | currency }}</div>
          </div>
          <div class="summary-item">
            <div class="label">Actual spending</div>
            <div class="value">{{ cashflowSummary.actualSpending | currency }}</div>
          </div>
          <div class="summary-item">
            <div class="label">Projected recurring bills</div>
            <div class="value">{{ cashflowSummary.projectedRecurring | currency }}</div>
          </div>
          <div class="summary-item">
            <div class="label">Net</div>
            <div class="value">{{ cashflowSummary.net | currency }}</div>
          </div>
        </div>

        <div class="chart-wrap" *ngIf="cashflowChartData?.labels?.length">
          <canvas
            baseChart
            [data]="cashflowChartData"
            [options]="cashflowChartOptions"
            [type]="'line'">
          </canvas>
        </div>

        <div class="hint">
          Projected recurring bills are calculated from each billâ€™s <b>nextDueDate</b> and <b>frequency</b> within the selected range.
        </div>
      </mat-card>
    </mat-tab>
  </mat-tab-group>

</div>
