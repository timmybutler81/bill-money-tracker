<div class="page">
  <div class="page-header">
    <div>
      <h1 class="page-title">Transactions</h1>
      <p class="page-subtitle">Add spending and review history.</p>
    </div>
  </div>

  <div class="pills">
    <div class="pill">
      <span>Count</span>
      <strong>{{ transactions.length }}</strong>
    </div>
    <div class="pill">
      <span>Total</span>
      <strong>{{ total() | currency }}</strong>
    </div>
  </div>

  <!-- Add Transaction -->
  <mat-card>
    <div class="section-title">Add transaction</div>

    <div class="form-grid">
      <mat-form-field appearance="outline" class="span-1">
        <mat-label>Date</mat-label>
        <!-- Keeping native input for now (simple). Can switch to MatDatepicker later. -->
        <input matInput type="date" [(ngModel)]="form.date" name="date" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="span-1">
        <mat-label>Amount</mat-label>
        <input
          matInput
          type="number"
          step="0.01"
          [(ngModel)]="form.amount"
          name="amount"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="span-1">
        <mat-label>Category</mat-label>
        <mat-select [(ngModel)]="form.categoryId" name="categoryId">
          <mat-option *ngFor="let c of categories" [value]="c.id">
            {{ c.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="span-1">
        <mat-label>Payment method</mat-label>
        <mat-select [(ngModel)]="form.paymentMethod" name="paymentMethod">
          <mat-option *ngFor="let pm of paymentMethods" [value]="pm.value">
            {{ pm.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="span-4">
        <mat-label>Description</mat-label>
        <input
          matInput
          [(ngModel)]="form.description"
          name="description"
          placeholder="Optional note"
        />
      </mat-form-field>

      <div class="span-4">
        <mat-checkbox [(ngModel)]="form.isRecurringInstance" name="isRecurringInstance">
          This is a recurring instance
        </mat-checkbox>
      </div>
    </div>

    <button mat-flat-button color="primary" (click)="add()">
      Add
    </button>
  </mat-card>

  <!-- Recent Transactions -->
  <mat-card style="margin-top: 12px;">
    <div class="section-title">Recent</div>

    <table class="table" *ngIf="transactions.length > 0; else empty">
      <thead>
        <tr>
          <th>Date</th>
          <th>Category</th>
          <th>Description</th>
          <th>Method</th>
          <th>Recurring?</th>
          <th class="text-right">Amount</th>
          <th class="text-right">Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let t of transactions; trackBy: trackById">
          <td>{{ t.date }}</td>
          <td>{{ categoryName(t.categoryId) }}</td>
          <td>{{ t.description || '-' }}</td>
          <td>{{ t.paymentMethod }}</td>
          <td>{{ t.isRecurringInstance ? 'Yes' : 'No' }}</td>
          <td class="text-right">{{ t.amount | currency }}</td>
          <td class="text-right">
            <button mat-stroked-button color="warn" (click)="delete(t.id)">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <ng-template #empty>
      <p class="text-muted">No transactions yet.</p>
    </ng-template>
  </mat-card>
</div>